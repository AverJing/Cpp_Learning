# CH14 向量，模板和异常 P354

- 本章内容概要：
<img src="01.jpg" style="zoom:100%" div alight="center">

## 14.1 问题
<img src="02.jpg" style="zoom:100%" div alight="center">
- vector，可以改变它的两方面属性：元素的数量和类型。
<img src="03.jpg" style="zoom:100%" div alight="center">
- 实际上，我们用来保存和访问数据的技术对所有重要计算模型来说都是最为基础也最为常用的技术。**在内存管理的最底层，所有的对象都是固定大小而且不存在类型的概念**。

## 14.2 改变大小
- 本章只考虑实现resize，push_back和赋值来改变自身大小。

### 14.2.1 表示方式
<img src="04.jpg" style="zoom:100%" div alight="center"> 
- 实际上vector就是这样实现的。尾后元素完全是想象中的。**默认构造函数不在空闲空间中分配内存**，只占用最小的存储空间（看习题16）。

### 14.2.2 reserve和capacity
- reserve可以增加内存空间，如果参数小于等于当前空间什么也不做。注意，我们并没有对预留空间中的元素进行初始化。毕竟，我们只是预留空间以备将来被push_back和resize使用。

### 14.2.3 resize
<img src="05.jpg" style="zoom:100%" div alight="center">  
- 感觉有重复初始化的浪费。

### 14.2.4 push_back
- 如果没有空间，我们将分配的空间大小加倍。实践已证明这种内存空间的扩张策略对于绝大多数vector应用都是一个好的选择，且这种策略已被用于大多数标准库vector的实现。

### 14.2.5 赋值
- 最简单的实现包括如下操作：
	- 为副本分配存储空间
	- 拷贝元素
	- 释放原有已分配的空间
	- 将sz，elem，space设置为新值 
	- 改进，如果被赋值的vector大小大于赋值对象，直接复制。
	- 当然，别忘了自我赋值。

### 14.2.6 到目前为止的vector类
<img src="06.jpg" style="zoom:100%" div alight="center">  
<img src="07.jpg" style="zoom:100%" div alight="center">  
- 构造函数中的sz感觉应该为0

## 14.3 模板
- 模板是一种机制，它令程序员能够使用类型作为类或函数的参数。当我们提供具体类型作为参数时，编译器会为之生成特定的类或函数。

### 14.3.1 类型作为模板参数
<img src="08.jpg" style="zoom:100%" div alight="center"> 
<img src="09.jpg" style="zoom:100%" div alight="center"> 

### 14.3.2 泛型编程
<img src="10.jpg" style="zoom:100%" div alight="center">  
- 泛型编程：由模板支撑，依赖编译时解析
- 面向对象编程：由类层次和虚函数支撑，依赖运行时解析。
<img src="11.jpg" style="zoom:100%" div alight="center"> 

### 14.3.3 概念（陌生）
- 模板由极大的灵活性和接近最优的性能。但模板的”内在“（定义）与其接口（声明）不能很好地分离。错误信息相当糟糕，而且错误信息在编译过程中的出现时间远远落后与我们的期望。
<img src="12.jpg" style="zoom:100%" div alight="center">
<img src="13.jpg" style="zoom:100%" div alight="center">
<img src="14.jpg" style="zoom:100%" div alight="center">

### 14.3.4 容器和继承
- P367